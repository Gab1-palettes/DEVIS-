import React, { useEffect, useRef, useState } from "react";

/**
 * DEMO 100% FRONT â€” Fonctionne tout de suite (aucun backend)
 * - Bouton "Essayer" + zone de chat simulÃ©e (devis, plan, panier, livraison)
 * - Parfait pour une mise en ligne rapide (Netlify / GitHub Pages)
 * - Copiez/collez tel quel dans votre app React (Tailwind recommandÃ©)
 */

// Styles utilitaires minimalistes (au cas oÃ¹ Tailwind n'est pas prÃ©sent dans l'aperÃ§u)
const S = {
  page: "min-h-screen w-full bg-[rgba(14,122,94,0.95)] text-white flex flex-col",
  container: "max-w-4xl w-full mx-auto px-6",
  hero: "py-10 md:py-14 flex flex-col md:flex-row items-center md:items-end justify-between gap-6",
  brand: "text-2xl md:text-3xl font-bold tracking-wide",
  sub: "text-sm md:text-base text-white/80",
  cta: "inline-flex items-center gap-2 rounded-xl bg-white text-emerald-700 px-5 py-3 hover:bg-emerald-50 transition",
  card: "bg-white rounded-2xl shadow-xl text-slate-900",
  cardInner: "p-5 md:p-6",
  hint: "text-xs text-white/80 mt-2",
  chatWrap: "h-[62vh] max-h-[72vh] flex flex-col",
  chatScroll: "flex-1 overflow-y-auto space-y-3 p-4 bg-white/90",
  chatInputBar: "border-t border-slate-200 bg-white p-3",
  input: "w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500",
  sendBtn: "inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg px-4 py-2",
  quickGrid: "grid grid-cols-2 md:grid-cols-4 gap-2",
  quickBtn: "rounded-lg bg-emerald-50 text-emerald-800 px-3 py-2 text-sm hover:bg-emerald-100",
  bubbleBot: "max-w-[80%] rounded-2xl px-4 py-3 text-sm shadow bg-white text-slate-900",
  bubbleUser: "max-w-[80%] rounded-2xl px-4 py-3 text-sm shadow bg-emerald-100 text-emerald-900 ml-auto",
};

function Bubble({ role, text }: { role: 'bot' | 'user'; text: string }) {
  return (
    <div className={role === 'bot' ? S.bubbleBot : S.bubbleUser}>
      <div className="whitespace-pre-wrap leading-relaxed">{text}</div>
    </div>
  );
}

const SCRIPT = [
  { role: 'bot', text: "Bonjour et bienvenue chez AGORA. Je peux crÃ©er un devis, un plan, constituer un panier et organiser la livraison." },
];

export default function AoaDemoWorking() {
  const [msgs, setMsgs] = useState<{role:'bot'|'user'; text:string}[]>(SCRIPT);
  const [val, setVal] = useState("");
  const [busy, setBusy] = useState(false);
  const scrollRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    scrollRef.current?.scrollTo({ top: scrollRef.current.scrollHeight, behavior: 'smooth' });
  }, [msgs, busy]);

  function reply(userText: string) {
    const lower = userText.toLowerCase();
    let answer = "Je peux aider avec un devis, un plan, un panier et la livraison.";
    if (/(devis|quote)/i.test(lower)) {
      answer = "Devis crÃ©Ã© : 4 modules 845Ã—1200 mm Ã  72 â‚¬ HT lâ€™unitÃ©. Total : 288 â‚¬ HT. Voulezâ€‘vous lâ€™envoyer par email ?";
    } else if (/(plan|schÃ©ma|design)/i.test(lower)) {
      answer = "Plan gÃ©nÃ©rÃ© : modÃ¨le hexagonal 4 m (8 pers), 6 cÃ´tÃ©s, 2 entrÃ©es. Export PDF disponible.";
    } else if (/(panier|cart|ajoute|ajouter)/i.test(lower)) {
      answer = "Produit(s) ajoutÃ©(s) au panier. Souhaitezâ€‘vous appliquer la remise pro ou poursuivre au tarif particulier ?";
    } else if (/(livraison|delivery|transport|truck)/i.test(lower)) {
      answer = "Livraison express sous 72 h possible. Merci dâ€™indiquer lâ€™adresse et le crÃ©neau souhaitÃ©.";
    }
    return answer;
  }

  function send(text?: string) {
    const t = (text ?? val).trim();
    if (!t) return;
    setVal("");
    setMsgs((m) => [...m, { role: 'user', text: t }]);
    setBusy(true);
    setTimeout(() => {
      setMsgs((m) => [...m, { role: 'bot', text: reply(t) }]);
      setBusy(false);
    }, 650);
  }

  return (
    <div className={S.page}>
      {/* HERO */}
      <div className={`${S.container} ${S.hero}`}>
        <div>
          <div className={S.brand}>AGORA â€¢ AOA Bot</div>
          <div className={S.sub}>DÃ©mo interactive â€” devis, plan, panier, livraison (simulation frontâ€‘end)</div>
        </div>
        <a href="#demo" className={S.cta}>
          ðŸš€ Essayer la dÃ©mo
        </a>
      </div>

      {/* DEMO */}
      <div id="demo" className={`${S.container} mb-10`}>
        <div className={S.card}>
          <div className={S.cardInner}>
            <div className="mb-3 text-sm text-slate-600">
              Astuce : cliquez sur un bouton rapide puis envoyez un message (ex: Â« CrÃ©er un devis pour 4 modules Â»).
            </div>

            <div className={S.quickGrid}>
              <button className={S.quickBtn} onClick={() => send("CrÃ©er un devis pour 4 modules")}>Devis</button>
              <button className={S.quickBtn} onClick={() => send("GÃ©nÃ©rer un plan 4 m pour 8 personnes")}>Plan</button>
              <button className={S.quickBtn} onClick={() => send("Ajoute au panier")}>Panier</button>
              <button className={S.quickBtn} onClick={() => send("Propose une livraison")}>Livraison</button>
            </div>

            <div ref={scrollRef} className={`${S.chatWrap}`}>
              <div className={S.chatScroll}>
                {msgs.map((m, i) => (
                  <Bubble key={i} role={m.role} text={m.text} />
                ))}
                {busy && (
                  <div className="text-slate-500 text-sm">AOA est en train d'Ã©crireâ€¦</div>
                )}
              </div>
              <div className={S.chatInputBar}>
                <form
                  onSubmit={(e) => { e.preventDefault(); send(); }}
                  className="flex items-center gap-2"
                >
                  <input
                    className={S.input}
                    placeholder="Ã‰crivez un messageâ€¦"
                    value={val}
                    onChange={(e) => setVal(e.target.value)}
                  />
                  <button type="submit" className={S.sendBtn}>Envoyer</button>
                </form>
              </div>
            </div>

            <div className="mt-3 text-xs text-slate-500">
              Simulation cÃ´tÃ© client uniquement. Les prix/quantitÃ©s sont indicatifs pour la dÃ©mo.
            </div>
          </div>
        </div>
        <div className={S.hint}>Partage LinkedIn : publiez un lien vers cette page hÃ©bergÃ©e (cf. consignes ciâ€‘dessous).</div>
      </div>

      {/* FOOTER INSTRUCTIONS */}
      <div className="w-full bg-[rgba(10,46,42,0.9)]">
        <div className={`${S.container} py-4 text-xs space-y-1`}>
          <div className="opacity-90">Comment la mettre en ligne rapidement :</div>
          <ol className="list-decimal ml-5 opacity-90 space-y-1">
            <li><b>Netlify</b> (le plus simple) : crÃ©ez un nouveau site, glissezâ€‘dÃ©posez un build (Vite/Next) contenant ce composant sur une page Â« /demo Â».</li>
            <li><b>GitHub Pages</b> : crÃ©ez un repo, ajoutez un index.html qui monte ce composant, activez Pages, publiez lâ€™URL.</li>
            <li><b>WordPress</b> : insÃ©rez une div #demo et embarquez le bundle du composant (iframe possible si besoin).</li>
          </ol>
          <div className="opacity-70">Texte de post LinkedIn suggÃ©rÃ© : Â« Testez notre assistant AGORA (devis, plan, panier, livraison) â†’ lien en commentaire Â».</div>
        </div>
      </div>
    </div>
  );
}






